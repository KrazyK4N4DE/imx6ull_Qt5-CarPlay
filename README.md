# 基于Qt5的车载中控

版本：V1.0

基于Qt5的车载中控，最终目标是放入开发板中使用触摸屏控制。目前含有车载主菜单 (CarPlayMain)，音乐播放器 (MusicPlayer)。更多功能正在开发中......

音乐播放器的轮子主要参考：<https://github.com/NJU-TJL/Qt5-MusicPlayer>

代码思路也有参考：<https://blog.csdn.net/mbs520/article/details/112873809?spm=1001.2014.3001.5501>

## 功能

**车载主菜单** (空空如也...时间问题，现在就两个按钮做了功能，其他待完善)：

![20230803221835](https://image-hosting-1313474851.cos.ap-shanghai.myqcloud.com/Notes/20230803221835.png)

- 获取当前日期时间，使用**定时器 + 信号与槽**刷新显示。
- 创建**共享内存**，实现主菜单进程与音乐播放器进程间通信，主要作用是：常见的车载项目，要么是只有播放器一个界面，要么是播放器作为主菜单工程所创建的进程，一旦退出回主菜单，播放器进程便结束，不再播放歌曲。本人想实现的功能是即使播放音乐后退回主菜单，音乐依旧能够进行，且能在外部实时控制音量、播放状态，比如拨号时需暂停音乐、启动倒车影像时音量需调小。底层原理就是进程通信，故选择使用共享内存来实现该功能。

**音乐播放器**：

![20230803223119](https://image-hosting-1313474851.cos.ap-shanghai.myqcloud.com/Notes/20230803223119.png)|![20230803223203](https://image-hosting-1313474851.cos.ap-shanghai.myqcloud.com/Notes/20230803223203.png)
---|---
![20230803223237](https://image-hosting-1313474851.cos.ap-shanghai.myqcloud.com/Notes/20230803223237.png)|![20230803223417](https://image-hosting-1313474851.cos.ap-shanghai.myqcloud.com/Notes/20230803223417.png)

- 使用文件操作打开音乐文件 (这里其实不妥，本地音乐最好还是一开始就扫描好所有歌曲并加载到列表中，这样才是适合车载触摸屏的操作，后续需修改)，支持.mp3，.flac文件。
- 解析歌词文件并随播放进度显示。
- Music类解析歌曲信息 (要是改成自动扫描本地歌曲的模式，歌曲信息就解析不出来，可能是信息太大push_back到类对象需要很久时间，其实现在很多车载中控都是联网的，自带各种网络音乐应用，本地音乐就不需要解析歌曲信息这一功能了，后续再修改)。
- 歌曲列表支持整理、排序、清空，并使用Qt内置的SQLite储存目前的歌曲列表。
- 播放按钮有两个QSS样式，即正在播放和暂停状态，使用信号与槽机制实现播放状态变化按钮跟随更新，滑槽与播放进度、播放时间同样使用信号与槽机制控制。
- 右上角退出按钮按下后回到主菜单界面，播放器隐藏且能继续播放。

## 设备及环境

- 硬件：imx6ull_pro，LCD屏幕
- 开发软件：Qt 5.12.8
- 操作系统：Windows、Linux皆可，最后移植到板子是靠Ubuntu中的Qt配置好交叉编译工具链实现的
- 交叉编译工具链：arm-buildroot-linux-gnueabihf-gcc v7.5.0
- 板子上的触摸库：tslib (记得设置tslib和Qt的环境变量)

## 使用

打开CarPlayMainWW工程，修改MainWidget.cpp中的变量：

![20230803225537](https://image-hosting-1313474851.cos.ap-shanghai.myqcloud.com/Notes/20230803225537.png)

1. 这是音乐播放器可执行文件的路径，可执行文件由qmake执行后生成，在Linux系统中就把.exe去掉。
2. 运行CarPlayMainWW工程的可执行文件。

## TODO

- [ ] 读取音乐文件的方式改为本地指定路径自动读取，取消数据库增删、解析歌曲信息功能。
- [ ] 取消延时隐藏窗口。
- [ ] 在开发板中(Linux)，程序结束后，共享内存并不会消失，找找看有没有解决办法。
- [ ] 更多的应用......
